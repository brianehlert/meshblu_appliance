# Meshblu - the message server for all
# Upstart configuration

description "appliance instance of meshblu"
author "Brian Ehlert <brian.ehlert@citrix.com>"

respawn

start on started mongod
stop on runlevel [06]

# console output

expect fork

# exec /usr/bin/node /opt/blu/meshblu/server.js --http --coap --mqtt

pre-start script
    for file in /opt/blu/log/*.log;
		do 
			mv -nv -- "$file" "$file.$(date +%Y%m%d_%H%M%S.txt)"
		done
		
	sleep 45
end pre-start script

script
	exec forever --sourceDir /opt/blu/meshblu \
	start -a -l /opt/blu/log/meshblu.log \
	-o /opt/blu/log/meshblu.stdout.log \
	-e /opt/blu/log/meshblu.stderr.log \
	--uid "meshblu" \
	-c /usr/bin/node server.js --http --coap --mqtt
end script
